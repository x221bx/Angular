<div class="products-container">
    <h2>Products</h2>

    <button class="view-details-btn" (click)="toggleAdd()">{{ showAddForm ? 'Cancel' : 'Add Product' }}</button>

    <div *ngIf="loading" style="margin:12px 0;color:#666;">Loading products...</div>
    <div *ngIf="!loading && !products.length" style="margin:12px 0;color:#666;">No products to show.</div>
    <div *ngIf="error" style="color:#dc2626;">{{ error }}</div>

    <div *ngIf="showAddForm" class="add-form"
        style="margin: 16px 0; padding: 12px; border: 1px solid #ddd; border-radius: 8px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <label>Title
                <input type="text" [(ngModel)]="newProduct.title" placeholder="Product title" />
            </label>
            <label>Price
                <input type="number" [(ngModel)]="newProduct.price" placeholder="0" />
            </label>
            <label>Brand
                <input type="text" [(ngModel)]="newProduct.brand" placeholder="Brand" />
            </label>
            <label>Category
                <input type="text" [(ngModel)]="newProduct.category" placeholder="Category" />
            </label>
            <label style="grid-column: span 2;">Image URL
                <input type="text" [(ngModel)]="newProduct.image" placeholder="https://..." />
            </label>
            <label style="grid-column: span 2;">Description
                <textarea [(ngModel)]="newProduct.description" rows="3" placeholder="Description..."></textarea>
            </label>
        </div>
        <div style="margin-top: 12px;">
            <button class="view-details-btn" (click)="addProduct()">Save</button>
        </div>
    </div>
    <div class="products-grid" *ngIf="!loading && products.length">
        <div class="product-card" *ngFor="let product of products">
            <img [src]="product.images[0]" [alt]="product.title" class="product-image" (error)="onImgError($event)"
                loading="lazy">
            <div class="product-info">
                <h3>{{ product.title }}</h3>
                <p class="category">{{ product.category }}</p>
                <p class="brand">{{ product.brand }}</p>
                <div class="rating">‚≠ê {{ product.rating }}</div>
                <div class="price">
                    <span class="original-price" *ngIf="product.discountPercentage">${{ product.price }}</span>
                    <span class="discounted-price">${{ product.price * (1 - (product.discountPercentage || 0) / 100)
                        }}</span>
                </div>
                <div class="product-actions">
                    <button class="add-to-cart-btn" (click)="addToCart(product)">Add to Cart</button>
                    <button class="view-details-btn" [routerLink]="['/product', product.id]">View Details</button>
                </div>
            </div>
        </div>
    </div>
</div>
