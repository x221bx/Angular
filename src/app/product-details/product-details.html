<div class="product-details-container" *ngIf="!loading && product">
    <nav class="breadcrumbs">
        <a routerLink="/products">Products</a>
        <span>/</span>
        <a routerLink="/products" [queryParams]="{ category: product.category }">{{ product.category }}</a>
        <span>/</span>
        <span class="crumb-current">{{ product.title }}</span>
    </nav>

    <div class="product-details">
        <div class="product-image-section">
            <img [src]="mainImage || product.images?.[0] || '/assets/images/placeholder.svg'" [alt]="product.title" class="product-main-image"
                (error)="onImgError($event)" loading="lazy">

            <div class="thumbs" *ngIf="product && product.images && product.images.length > 1">
                <img *ngFor="let img of product.images" [src]="img" class="thumb" [class.active]="img === mainImage"
                    (click)="selectImage(img)" (error)="onImgError($event)" alt="thumbnail">
            </div>
        </div>

        <div class="product-info-section">
            <h1 class="product-title">{{ product.title }}</h1>
            <div class="chips">
                <span class="chip brand">{{ product.brand }}</span>
                <span class="chip category">{{ product.category }}</span>
            </div>

            <div class="product-rating">
                <span class="rating-stars">{{ '★'.repeat(Math.round(product.rating)) }}<span class="muted">{{
                        '☆'.repeat(5 - Math.round(product.rating)) }}</span></span>
                <span class="rating-value">{{ product.rating | number:'1.1-1' }}</span>
            </div>

            <div class="product-price">
                <span class="original-price" *ngIf="product.discountPercentage">${{ (product.price |
                    discountPrice:product.discountPercentage).original }}</span>
                <span class="discounted-price">${{ (product.price | discountPrice:product.discountPercentage).discounted
                    }}</span>
                <span class="discount-badge" *ngIf="product.discountPercentage">-{{ product.discountPercentage
                    }}%</span>
            </div>

            <div class="qty-row">
                <label>Quantity</label>
                <div class="qty-controls">
                    <button class="qty-btn" (click)="dec()">-</button>
                    <input type="number" [(ngModel)]="qty" min="1" max="99" />
                    <button class="qty-btn" (click)="inc()">+</button>
                </div>
            </div>

            <div class="cta-row">
                <button class="add-btn" (click)="addToCart()" [disabled]="!qty || qty < 1">Add to Cart</button>
                <button class="secondary-btn" (click)="goBack()">Back</button>
            </div>

            <div class="added-toast" *ngIf="added">Added to cart ✓</div>

            <div class="product-description">
                <h3>Description</h3>
                <p>{{ product.description }}</p>
            </div>
        </div>
    </div>

    <section class="related" *ngIf="related.length">
        <h3>You might also like</h3>
        <div class="related-grid">
            <div class="related-card" *ngFor="let p of related">
                <img [src]="p.images[0]" alt="{{p.title}}" class="related-img" (error)="onImgError($event)">
                <div class="related-info">
                    <h4 class="related-title">{{ p.title }}</h4>
                    <div class="related-price">${{ p.price }}</div>
                    <div class="related-actions">
                        <button class="mini-btn" (click)="addToCartProduct(p)">Add</button>
                        <a class="mini-link" [routerLink]="['/product', p.id]">View</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<div class="product-details-container" *ngIf="loading">
    <p>Loading product...</p>
</div>

<div class="not-found" *ngIf="!loading && !product">
    <h2>Product Not Found</h2>
    <p>The product you're looking for doesn't exist.</p>
    <button class="back-btn" (click)="goBack()">Back to Products</button>
</div>
